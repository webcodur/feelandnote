# AI 기반 셀럽 콘텐츠 자동 수집

> 상태: 기획 중
> 작성일: 2025-01-11

---

## 1. 개요

### 1.1 배경
현재 백오피스에서 셀럽 콘텐츠 등록 시:
- DB에 이미 존재하는 콘텐츠만 검색 가능
- 새 콘텐츠는 수동으로 등록해야 함
- 셀럽별 다량의 콘텐츠를 일일이 등록하는 것은 비효율적

### 1.2 목표
외부 URL을 입력하면 AI가 자동으로:
1. 셀럽 프로필 생성 (없는 경우)
2. 추천 콘텐츠 목록 추출
3. 콘텐츠 정보 조회 및 등록
4. 리뷰/추천사 자동 생성

### 1.3 예시 소스
- https://bookauthority.org/profile/scott-galloway
- https://mostrecommendedbooks.com/people/bill-gates-recommended-books
- 인터뷰 기사 (책/영화 추천 언급)
- 유튜브 영상 (추천 콘텐츠 언급)

---

## 2. 현재 문제점

### 2.1 콘텐츠 검색 한계
```
현재: DB 내 콘텐츠만 검색
필요: 외부 API (네이버, TMDB 등) 연동 검색
```

### 2.2 수동 작업 과다
```
셀럽 1명당 추천 콘텐츠 20~50개
→ 각각 검색 → 등록 → 리뷰 작성
→ 시간 소요 과다
```

---

## 3. 제안 솔루션

### 3.1 전체 플로우

```
┌─────────────────────────────────────────────────────────────┐
│ 관리자: URL 입력                                             │
│ (예: bookauthority.org/profile/scott-galloway)              │
└──────────────────────────┬──────────────────────────────────┘
                           ▼
┌─────────────────────────────────────────────────────────────┐
│ Step 1: 페이지 파싱                                          │
│ - URL fetch → HTML 추출                                      │
│ - AI에게 구조화된 데이터 요청                                 │
└──────────────────────────┬──────────────────────────────────┘
                           ▼
┌─────────────────────────────────────────────────────────────┐
│ Step 2: 셀럽 프로필 처리                                     │
│ - 이름으로 기존 셀럽 검색                                     │
│ - 없으면 → 새 셀럽 프로필 생성                                │
│ - 있으면 → 기존 프로필 사용                                   │
└──────────────────────────┬──────────────────────────────────┘
                           ▼
┌─────────────────────────────────────────────────────────────┐
│ Step 3: 콘텐츠 목록 처리                                     │
│ - AI가 추출한 콘텐츠 목록 순회                                │
│ - 각 콘텐츠:                                                 │
│   1. DB에서 검색 (title 매칭)                                │
│   2. 없으면 → 외부 API 검색 (네이버/TMDB/IGDB)               │
│   3. 없으면 → 새 콘텐츠 생성 (AI 추출 정보 기반)              │
└──────────────────────────┬──────────────────────────────────┘
                           ▼
┌─────────────────────────────────────────────────────────────┐
│ Step 4: 리뷰 생성                                            │
│ - 각 콘텐츠에 대해 AI가 리뷰 생성                             │
│ - 원본 페이지의 추천사 참고                                   │
│ - 적절한 별점 추정                                           │
└──────────────────────────┬──────────────────────────────────┘
                           ▼
┌─────────────────────────────────────────────────────────────┐
│ Step 5: 검토 및 확정                                         │
│ - 관리자에게 결과 미리보기 제공                               │
│ - 수정/삭제 가능                                             │
│ - 확정 시 DB에 일괄 저장                                     │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 AI 역할

| 단계 | AI 입력 | AI 출력 |
|------|---------|---------|
| 페이지 파싱 | HTML 텍스트 | 구조화된 JSON (셀럽 정보 + 콘텐츠 목록) |
| 콘텐츠 매칭 | 추출된 제목 | 정규화된 검색 쿼리 |
| 리뷰 생성 | 콘텐츠 정보 + 원본 추천사 | 자연스러운 한국어 리뷰 |

### 3.3 AI API 사용

```typescript
// 사용자(관리자)의 Gemini API 키 사용
// profiles.gemini_api_key 또는 별도 관리자 설정

interface AIConfig {
  provider: 'gemini'
  apiKey: string  // 관리자 개인 키 또는 서비스 키
  model: 'gemini-1.5-flash' | 'gemini-1.5-pro'
}
```

---

## 4. 상세 설계

### 4.1 입력 UI

```
┌─────────────────────────────────────────────────────────────┐
│ AI 콘텐츠 수집                                               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ URL 입력                                                    │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ https://bookauthority.org/profile/scott-galloway       │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ 콘텐츠 유형                                                  │
│ (●) 도서  ( ) 영상  ( ) 게임  ( ) 음악  ( ) 자격증          │
│                                                             │
│ AI 설정                                                     │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ Gemini API Key: [sk-...]                               │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│                              [취소]  [수집 시작]             │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 결과 미리보기 UI

```
┌─────────────────────────────────────────────────────────────┐
│ 수집 결과 미리보기                                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ 셀럽 정보                                                    │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ [아바타]  Scott Galloway                                │ │
│ │           작가, 교수                                    │ │
│ │           NYU 경영대학원 교수, 베스트셀러 작가          │ │
│ │           상태: ⚠️ 새로 생성됨                          │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ 추출된 콘텐츠 (12개)                                         │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ [✓] The Four: The Hidden DNA of Amazon, Apple...       │ │
│ │     → DB 매칭됨 (ISBN: 978-0735213654)                  │ │
│ │     → 리뷰: "빅테크 기업의 본질을 파헤친..."            │ │
│ ├─────────────────────────────────────────────────────────┤ │
│ │ [✓] Post Corona: From Crisis to Opportunity            │ │
│ │     → 네이버 API 매칭 (새로 등록 예정)                   │ │
│ │     → 리뷰: "팬데믹 이후 비즈니스 변화를..."            │ │
│ ├─────────────────────────────────────────────────────────┤ │
│ │ [✓] The Algebra of Happiness                           │ │
│ │     → ⚠️ 매칭 실패 - 수동 입력 필요                     │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ 요약: 12개 중 10개 자동 매칭, 2개 수동 확인 필요             │
│                                                             │
│                    [수정]  [취소]  [등록 확정]               │
└─────────────────────────────────────────────────────────────┘
```

### 4.3 AI 프롬프트 설계

#### 페이지 파싱 프롬프트

```
다음 HTML에서 유명인의 추천 콘텐츠 정보를 추출해주세요.

JSON 형식으로 응답:
{
  "celeb": {
    "name": "이름",
    "name_ko": "한국어 이름 (있으면)",
    "bio": "소개",
    "category": "author|youtuber|actor|...",
    "image_url": "프로필 이미지 URL"
  },
  "contents": [
    {
      "title": "원제",
      "title_ko": "한국어 제목 (있으면)",
      "creator": "저자/감독",
      "type": "BOOK|VIDEO|GAME|MUSIC",
      "recommendation": "원본 추천사 (있으면)",
      "isbn": "ISBN (있으면)"
    }
  ]
}

HTML:
{html_content}
```

#### 리뷰 생성 프롬프트

```
다음 콘텐츠에 대한 {celeb_name}의 추천 리뷰를 작성해주세요.

콘텐츠: {content_title} by {creator}
원본 추천사: {original_recommendation}

조건:
- 1~3문장의 간결한 한국어 리뷰
- 추천 이유가 드러나도록
- 자연스러운 말투
- 별점 추정 (1~5, 0.5 단위)

JSON 형식으로 응답:
{
  "review": "리뷰 텍스트",
  "rating": 4.5
}
```

---

## 5. 기술 구현

### 5.1 필요한 API

| API | 용도 | 현재 상태 |
|-----|------|----------|
| Gemini | AI 파싱/생성 | 연동 필요 |
| 네이버 책 | 도서 검색 | 기존 연동 있음 |
| TMDB | 영상 검색 | 기존 연동 있음 |
| IGDB | 게임 검색 | 기존 연동 있음 |

### 5.2 파일 구조

```
sw/web-bo/src/
├── app/(admin)/celebs/
│   └── import/
│       └── page.tsx              # AI 수집 페이지
│
├── actions/admin/
│   └── ai-import/
│       ├── parseUrl.ts           # URL 파싱
│       ├── matchContent.ts       # 콘텐츠 매칭
│       ├── generateReview.ts     # 리뷰 생성
│       └── confirmImport.ts      # 등록 확정
│
└── lib/
    └── ai/
        └── gemini.ts             # Gemini API 클라이언트
```

### 5.3 DB 고려사항

```sql
-- 콘텐츠 출처 추적 (선택)
ALTER TABLE user_contents
ADD COLUMN source_url TEXT;

-- 또는 metadata 활용
-- metadata: { "source_url": "...", "imported_at": "..." }
```

---

## 6. 단계별 구현 계획

### Phase 1: 기본 기능
- [ ] 콘텐츠 추가 시 외부 API 검색 연동 (현재 문제 해결)
- [ ] 새 콘텐츠 직접 등록 기능

### Phase 2: AI 수집 MVP
- [ ] Gemini API 연동
- [ ] URL 파싱 → 콘텐츠 목록 추출
- [ ] 결과 미리보기 UI

### Phase 3: 자동화 완성
- [ ] 셀럽 자동 생성
- [ ] 콘텐츠 자동 매칭 (DB + 외부 API)
- [ ] 리뷰 자동 생성
- [ ] 일괄 등록

### Phase 4: 확장
- [ ] 다양한 소스 지원 (Goodreads, 인터뷰 기사 등)
- [ ] 배치 처리 (여러 URL 동시 처리)
- [ ] 수집 히스토리 관리

---

## 7. 우선순위 결정 필요

### 즉시 해결 (Phase 1)
1. 콘텐츠 추가 시 외부 API 검색 연동
2. 검색 결과에서 새 콘텐츠 등록

### AI 기능 (Phase 2+)
- Gemini API 키 관리 방식 결정 필요
  - 옵션 A: 서비스 공용 키
  - 옵션 B: 관리자 개인 키 입력
  - 옵션 C: 환경변수 설정

---

## 8. 질문/결정 사항

1. **외부 API 검색 우선 구현?**
   - 현재 문제 (DB 내 콘텐츠만 검색) 먼저 해결

2. **Gemini API 키 관리?**
   - 서비스 키 vs 개인 키

3. **지원할 소스 범위?**
   - bookauthority.org만 vs 범용 파서

4. **리뷰 자동 생성 수준?**
   - 단순 번역 vs 창작 리뷰

# 07-01. 소셜 시스템

## 개요

소셜 시스템은 사용자 간 연결과 상호작용을 담당한다. 친구, 팔로우 관계를 관리하고, 영향력과 확산 점수를 계산하여 피드 노출에 반영한다.

---

## 관계 유형

### 팔로우 (단방향)

| 항목 | 설명 |
|------|------|
| 정의 | A가 B를 팔로우 (B는 A를 팔로우하지 않음) |
| 효과 | A의 피드에 B의 활동 노출 |
| 알림 | B에게 "A님이 팔로우했습니다" 알림 |

### 친구 (양방향)

| 항목 | 설명 |
|------|------|
| 정의 | A와 B가 서로 팔로우 |
| 효과 | 양쪽 피드에 서로의 활동 노출 |
| 가중치 | 영향력 계산 시 팔로워보다 높은 가중치 |

---

## 팔로우 기능

### 팔로우하기
- 다른 유저 프로필에서 "팔로우" 버튼 클릭
- 즉시 팔로우 관계 성립
- 상대방에게 알림 발송

### 언팔로우
- "팔로잉" 버튼 클릭 시 언팔로우
- 즉시 관계 해제
- 알림 없음

### 팔로우 목록
- 내 팔로잉: 내가 팔로우한 유저 목록
- 내 팔로워: 나를 팔로우한 유저 목록
- 친구: 상호 팔로우 유저 목록

---

## 영향력

### 정의
사용자의 소셜 파워를 수치화한 값. 친구, 팔로워, 업적 점수를 종합하여 계산.

### 계산 공식

```
영향력 = (친구 수 × 10) + (팔로워 수 × 5) + 업적 점수
```

### 가중치 근거

| 요소 | 가중치 | 근거 |
|------|--------|------|
| 친구 | ×10 | 양방향 관계, 가장 강한 연결 |
| 팔로워 | ×5 | 단방향이지만 관심의 증거 |
| 업적 점수 | ×1 | 개인 활동 반영 |

### 계산 예시

**유저 A**
- 친구: 50명
- 팔로워: 200명 (친구 제외, 순수 팔로워)
- 업적 점수: 1,530점

```
영향력 = (50 × 10) + (200 × 5) + 1,530
      = 500 + 1,000 + 1,530
      = 3,030
```

### 영향력 등급

| 등급 | 영향력 구간 | 명칭 |
|------|-------------|------|
| 1 | 0 ~ 499 | 새싹 |
| 2 | 500 ~ 1,999 | 묘목 |
| 3 | 2,000 ~ 4,999 | 나무 |
| 4 | 5,000 ~ 14,999 | 숲 |
| 5 | 15,000 ~ 49,999 | 산맥 |
| 6 | 50,000+ | 대륙 |

---

## 확산 점수

### 정의
콘텐츠 피드에서 다른 유저에게 노출될 확률을 결정하는 점수.

### 계산 공식

```
확산 점수 = 영향력
```

영향력을 그대로 확산 점수로 사용. 별도 계산 불필요.

### 피드 노출 우선순위

| 확산 점수 | 노출 우선순위 |
|-----------|---------------|
| 0 ~ 999 | 낮음 |
| 1,000 ~ 4,999 | 보통 |
| 5,000 ~ 14,999 | 높음 |
| 15,000+ | 최상위 |

### 추가 보정

| 보정 요소 | 효과 |
|-----------|------|
| 최신 글 (24시간 이내) | +20% |
| 팔로우 중인 유저 | 최우선 노출 |

---

## 갱신 주기

### 팔로우/친구 수
- 실시간 갱신
- 팔로우/언팔로우 발생 시 즉시 반영

### 영향력
- 준실시간 갱신
- 구성 요소 변동 시 재계산
- 캐싱 적용 (1분)

### 확산 점수
- 영향력과 동일하게 갱신

---

## 차단 기능

### 차단하기
- 특정 유저를 차단
- 차단된 유저: 내 프로필/콘텐츠 접근 불가
- 차단된 유저: 나를 팔로우 불가

### 차단 해제
- 차단 목록에서 해제 가능
- 해제 시 이전 팔로우 관계 복원 안 됨

### 차단 시 처리
- 기존 팔로우 관계 자동 해제
- 서로의 피드에서 제외

---

## 데이터 모델 (개념)

### Follow

| 필드 | 타입 | 설명 |
|------|------|------|
| id | string | 고유 식별자 |
| followerId | string | 팔로우 하는 유저 |
| followingId | string | 팔로우 받는 유저 |
| createdAt | datetime | 팔로우 일시 |

### Block

| 필드 | 타입 | 설명 |
|------|------|------|
| id | string | 고유 식별자 |
| blockerId | string | 차단한 유저 |
| blockedId | string | 차단당한 유저 |
| createdAt | datetime | 차단 일시 |

### UserSocial (캐시)

| 필드 | 타입 | 설명 |
|------|------|------|
| userId | string | 유저 ID |
| friendCount | number | 친구 수 |
| followerCount | number | 팔로워 수 |
| followingCount | number | 팔로잉 수 |
| influence | number | 영향력 (계산값) |
| updatedAt | datetime | 갱신일시 |

---

## UI 구성

### 프로필 헤더

```
┌─────────────────────────────────────────┐
│ [아바타]                                │
│                                         │
│ 닉네임                                  │
│ @username                               │
│                                         │
│ 🌳 나무 (영향력 3,030)                  │
│                                         │
│ 팔로워 250  |  팔로잉 180  |  친구 50   │
│                                         │
│ [팔로우] 또는 [팔로잉 ✓]                │
└─────────────────────────────────────────┘
```

### 팔로우 목록

```
┌─────────────────────────────────────────┐
│ [팔로워] [팔로잉] [친구]                │
├─────────────────────────────────────────┤
│ [아바타] 닉네임          [팔로우]       │
│          @username                      │
├─────────────────────────────────────────┤
│ [아바타] 닉네임          [팔로잉 ✓]     │
│          @username                      │
├─────────────────────────────────────────┤
│ ...                                     │
└─────────────────────────────────────────┘
```

---

## 연동 모듈

- **점수 시스템**: 업적 점수 → 영향력 계산
- **콘텐츠 피드**: 확산 점수 → 피드 노출 순위
- **칭호 시스템**: 팔로워 수 → 소셜 칭호 체크
- **알림 시스템**: 팔로우 발생 시 알림

---

*04_시스템_소셜.md*